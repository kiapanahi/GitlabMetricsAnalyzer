{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "GitLab Metrics Configuration",
  "description": "Configuration for GitLab metrics collection including project scope, identity mapping, and exclusion rules",
  "type": "object",
  "properties": {
    "GitLab": {
      "type": "object",
      "properties": {
        "BaseUrl": {
          "type": "string",
          "description": "Base URL of the GitLab instance"
        },
        "Token": {
          "type": "string",
          "description": "GitLab Personal Access Token (can be set via GITLAB_TOKEN environment variable)"
        }
      },
      "required": ["BaseUrl", "Token"]
    },
    "Metrics": {
      "type": "object",
      "properties": {
        "ProjectScope": {
          "type": "object",
          "description": "Configuration for project filtering and scoping",
          "properties": {
            "IncludeProjects": {
              "type": "array",
              "items": { "type": "integer" },
              "description": "List of project IDs to include (empty = include all)"
            },
            "ExcludeProjects": {
              "type": "array", 
              "items": { "type": "integer" },
              "description": "List of project IDs to exclude"
            },
            "IncludeProjectPatterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "List of project name regex patterns to include"
            },
            "ExcludeProjectPatterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "List of project name regex patterns to exclude"
            }
          }
        },
        "Identity": {
          "type": "object",
          "description": "Configuration for developer identity mapping and bot detection",
          "properties": {
            "BotRegexPatterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Regex patterns to identify bot accounts"
            },
            "IdentityOverrides": {
              "type": "object",
              "description": "Manual identity mapping to canonical developers",
              "patternProperties": {
                ".*": {
                  "type": "object",
                  "properties": {
                    "DisplayName": { "type": "string" },
                    "PrimaryEmail": { "type": "string" },
                    "PrimaryUsername": { "type": "string" },
                    "AliasEmails": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "AliasUsernames": {
                      "type": "array", 
                      "items": { "type": "string" }
                    }
                  },
                  "required": ["DisplayName", "PrimaryEmail", "PrimaryUsername"]
                }
              }
            }
          }
        },
        "Excludes": {
          "type": "object",
          "description": "Various exclusion rules",
          "properties": {
            "CommitPatterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Commit message regex patterns to exclude"
            },
            "BranchPatterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Branch name regex patterns to exclude"
            },
            "FilePatterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "File path regex patterns to exclude from metrics"
            }
          }
        }
      },
      "required": ["ProjectScope", "Identity", "Excludes"]
    }
  },
  "required": ["GitLab", "Metrics"]
}